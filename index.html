

<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Enat Sverige</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #003578;
      color: #ffc200;
      padding: 2rem;
      text-align: center;
    }
    h1 { font-size: 2.5rem; margin-bottom: 1rem; }
    h2 { font-size: 1.2rem; }
    form {
      margin: 1rem auto;
      background: #004a99;
      padding: 1rem;
      border-radius: 8px;
      max-width: 400px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    label {
      display: block;
      text-align: left;
      margin-top: 1rem;
      font-weight: bold;
    }
    input, select {
      width: calc(100% - 10px);
      padding: 0.5rem;
      margin-top: 0.25rem;
      background-color: #ffc200;
      color: #003578;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 1rem;
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      background-color: #336bb8;
      color: white;
      border-radius: 25px;
      cursor: pointer;
    }
    button:hover {
      background-color: #417fd1;
    }
    #message {
      margin-top: 2rem;
      font-size: 1.4rem;
      font-weight: bold;
    }
    img {
      max-width: 200px;
      margin-bottom: 1rem;
    }
    .link {
      font-size: 0.9rem;
      color: #ffc200;
      cursor: pointer;
      text-decoration: underline;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>

  <h1>ENAT SVERIGE</h1>
  <img src="enat-sverige-logga.png" alt="Enat Sverige Logga"/>
<div style="max-width: 800px; margin: auto; padding: 20px;">
  <h2>Om oss - Enat Sverige</h2>

  <div id="om-oss-text">
    <p><strong>Vår vision</strong></p>
    <p>
      Enat Sverige är en organisation som arbetar för att förena det svenska folket genom en gemensam känsla av stolthet, identitet och samhörighet. Vi tror på ett Sverige där vår kultur, historia och traditioner värnas, och där alla som kallar Sverige sitt hem kan mötas i respekt och gemenskap. Vår ideologi, KristeNationalSocialism (KNS), är en vägledande filosofi för dem som delar vår vision, men vi välkomnar alla svenskar att delta i vår strävan efter ett starkare och mer enat land – oavsett tro eller bakgrund. Ingen tvingas att ansluta sig till KNS eller att bli kristen; vår dörr är öppen för alla som vill bidra till ett bättre Sverige.
    </p>
    
    <p><strong>Vårt syfte</strong></p>
    <p>
      Vi strävar efter att bygga en plattform där svenskar kan mötas, dela sina åsikter och forma en framtid baserad på nationell enhet, självständighet och rättvisa. Genom att fokusera på lokala lösningar och kristna värderingar som kärlek till nästan, barmhärtighet och gemenskap, vill vi skapa ett samhälle där familjen är kärnan, hälsan prioriteras och sanningen respekteras. Vi står för en fredlig nationalism som stärker Sverige utan att hota andra, och vi motsätter oss globala krafter som urholkar vår suveränitet och kultur.
    </p>

    <div id="rest-av-texten" style="display: none;">
      <p><strong>Vår ideologi: KristeNationalSocialism (KNS)</strong></p>
      <p>
        KNS är en modern vision för ett självständigt och enat Sverige, byggt på följande principer:
      </p>

      <h4>Nationell enhet och självständighet</h4>
      <p>Vi värnar om Sveriges kulturella identitet och suveränitet, fria från påverkan av globala företag eller överstatliga organisationer.</p>

      <h4>Ekonomisk självförsörjning</h4>
      <p>Vi främjar lokal produktion och handel för att skapa en stark, oberoende ekonomi som gynnar svenska medborgare.</p>

      <h4>Kristna värderingar som vägledning</h4>
      <p>Vi inspireras av kristen moral – såsom kärlek, rättvisa och familjevärden – men tvingar ingen att anamma kristendomen.</p>

      <h4>Fredlig nationalism</h4>
      <p>Vi fokuserar på att stärka Sverige utan aggression mot andra nationer, och vi löser konflikter genom diplomati och förståelse.</p>

      <h4>Anti-globalism</h4>
      <p>Vi motsätter oss kulturell utblandning och globala ideologier, och lyfter istället fram en unik svensk identitet.</p>

      <p><strong>Lösningar på dagens utmaningar</strong></p>

      <h4>Låg nativitet</h4>
      <p>Genom generösa bidrag till familjer, bostadsstöd för unga par och en kultur som hyllar föräldraskap vill vi öka födelsetalen och stärka familjen som samhällens grund.</p>

      <h4>Kriminalitet och kulturell oro</h4>
      <p>Vi förespråkar striktare invandringspolitik och fler resurser till rättsväsendet för att skapa trygghet i samhället och minska brottsligheten.</p>

      <h4>Ekonomisk ojämlikhet</h4>
      <p>En ekonomi fri från globala bankers inflytande där lokala företag och småskalighet prioriteras för att skapa rättvisa möjligheter för alla medborgare.</p>

      <h4>Ohälsa</h4>
      <p>Gratis sjukvård och förebyggande hälsa genom näringsrik kost, motion och tillgång till naturen är centrala delar i vår vision för ett friskare Sverige.</p>

      <h4>Social isolering och skärmtid</h4>
      <p>Begränsad skärmtid för barn och unga kombinerat med organiserade läger och aktiviteter i naturen för att främja social samvaro och mental hälsa.</p>

      <h4>Korruption och desinformation</h4>
      <p>Kyrkan och oberoende instanser granskar medier och makthavare för att säkerställa transparens, ärlighet och fri information i samhället.</p>

      <p><strong>StormFörbundet – En trygg grund</strong></p>
      <p>
        StormFörbundet (SF) är ett statligt finansierat kristet nätverk där familjer samarbetar för att bygga en stark och trofast gemenskap. SF fungerar som en stabil grund där alla kan känna sig välkomna och trygga.
      </p>

      <p><strong>Vardagslivet i ett enat Sverige</strong></p>

      <h4>Småbonde</h4>
      <p>En småbonde vaknar och arbetar på sin gård, trygg i att hans familj får stöd från samhället och lever i harmoni med naturen.</p>

      <h4>Skolor</h4>
      <p>Barnen går i skolor där de lär sig praktiska färdigheter och svenska traditioner, samtidigt som de utvecklar sin kreativitet och kunskap.</p>

      <h4>Familjer och gemenskap</h4>
      <p>Familjer samlas för gemensamma måltider och deltar i lokala läger och aktiviteter som stärker banden mellan generationer och grannar.</p>

      <h4>Ekonomi</h4>
      <p>Ekonomin är stabil, fri från globala bankers påverkan, och bygger på lokal produktion, handel och hållbarhet.</p>

      <p><strong>Varför Enat Sverige?</strong></p>
      <p>
        Vi tror på ett Sverige där människor känner sig trygga, hörda och stolta över sin identitet. Enat Sverige är en rörelse för dem som vill bygga ett starkare, mer enat och självständigt land där framtiden formas av gemenskap och ansvarstagande.
      </p>
    </div>

    <button onclick="toggleText()" id="lasMerBtn" style="margin-top: 10px;">Läs mer</button>
  </div>
</div>

<script>
  function toggleText() {
    const restText = document.getElementById('rest-av-texten');
    const btn = document.getElementById('lasMerBtn');
    if (restText.style.display === 'none' || restText.style.display === '') {
      restText.style.display = 'block';
      btn.textContent = 'Visa mindre';
    } else {
      restText.style.display = 'none';
      btn.textContent = 'Läs mer';
    }
  }
</script>

 <div id="active-users" style="padding: 1rem; background: #ffc200; color: black; font-weight: bold; text-align: center;">
  Laddar antal aktiva användare...
</div>

<form id="register-form">
  <h2>Registrera</h2>
  <label>Email</label>
  <input type="email" id="reg-email" required />
  <label>Lösenord</label>
  <input type="password" id="reg-password" required />
  <label>Användarnamn</label>
  <input type="text" id="username" required />
  <label>Förnamn</label>
  <input type="text" id="firstname" required />
  <label>Hur fick du reda på oss?</label>
  <select id="referral">
    <option value="">Välj ett alternativ</option>
    <option>Sociala Medier</option>
    <option>Telegram</option>
    <option>Kompis/Familj</option>
    <option>Annat</option>
  </select>
  <button type="submit">Registrera</button>
</form>

<form id="login-form">
  <h2>Logga in</h2>
  <label>Email</label>
  <input type="email" id="login-email" required />
  <label>Lösenord</label>
  <input type="password" id="login-password" required />
  <button type="submit">Logga in</button>
  <div class="link" onclick="forgotPassword()">Glömt lösenord?</div>
</form>

<div id="message" style="display:none;"></div>

<form id="update-form" style="display:none;">
  <h2>Uppdatera din information</h2>
  <label>Ny email</label>
  <input type="email" id="new-email"/>
  <label>Nytt användarnamn</label>
  <input type="text" id="new-username"/>
  <button type="submit">Uppdatera</button>
</form>

<script>
  const supabase = window.supabase.createClient(
    'https://jtbcqgjkvzgcjobfbtad.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp0YmNxZ2prdnpnY2pvYmZidGFkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MzU0NTksImV4cCI6MjA2OTExMTQ1OX0.ogacm-3bmQI7WDgHZSI2r6jDOrDAGMfI7QtG0avYMTQ'
  );

  // Funktion för att hämta och visa antal aktiva användare
  async function updateActiveUsersCount() {
    const { data, error } = await supabase
      .from('Profiles')
      .select('id');

    const activeUsersDiv = document.getElementById('active-users');
    if (error) {
      activeUsersDiv.textContent = 'Kunde inte hämta aktiva användare';
      console.error(error);
    } else {
      activeUsersDiv.textContent = `Aktiva användare: ${data.length}`;
    }
  }

  // Kör när sidan laddas
  updateActiveUsersCount();

  const registerForm = document.getElementById('register-form');
  const loginForm = document.getElementById('login-form');
  const updateForm = document.getElementById('update-form');
  const messageBox = document.getElementById('message');

  registerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('reg-email').value;
    const password = document.getElementById('reg-password').value;
    const username = document.getElementById('username').value;
    const firstname = document.getElementById('firstname').value;
    const referral = document.getElementById('referral').value;

    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: { emailRedirectTo: window.location.href }
    });

    if (error || !data.user) {
      alert('Fel: ' + (error?.message || "Kunde inte skapa konto"));
      return;
    }

    const userId = data.user.id;

    const { error: insertError } = await supabase.from('Profiles').insert([{
      id: userId,
      username,
      firstname,
      referral
    }]);

    if (insertError) {
      alert('Kunde inte spara profil: ' + insertError.message);
      return;
    }

    registerForm.style.display = 'none';
    loginForm.style.display = 'none';
    updateForm.style.display = 'block';
    showWelcome(userId, firstname, false);

    // Uppdatera räknaren när någon ny registrerar sig
    updateActiveUsersCount();
  });

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;

    const { data, error } = await supabase.auth.signInWithPassword({ email, password });

    if (error || !data.user) {
      alert('Fel vid inloggning: ' + (error?.message || "Inloggning misslyckades"));
      return;
    }

    const userId = data.user.id;
    const { data: profile } = await supabase
      .from('Profiles')
      .select('firstname')
      .eq('id', userId)
      .single();

    loginForm.style.display = 'none';
    registerForm.style.display = 'none';
    updateForm.style.display = 'block';
    showWelcome(userId, profile?.firstname || "Okänd", true);
  });

  function showWelcome(userId, firstname, isReturning) {
    messageBox.style.display = 'block';
    let startTime;

    supabase.auth.getUser().then(({ data }) => {
      const createdAt = new Date(data.user.created_at);
      startTime = createdAt;

      messageBox.innerHTML = `
        <div>${isReturning ? 'Välkommen tillbaka' : 'Välkommen'}, <strong>${firstname}</strong>!</div>
        <div>Konto skapades: ${createdAt.toLocaleString()}</div>
        <div>Tid sedan skapande: <span id="timer"></span></div>
        <br><a href="users.html" style="color:#ffc200;text-decoration:underline;">Se alla användare</a>
      `;

      setInterval(() => {
        const diff = new Date() - startTime;
        const seconds = Math.floor(diff / 1000) % 60;
        const minutes = Math.floor(diff / 60000) % 60;
        const hours = Math.floor(diff / 3600000);
        document.getElementById('timer').textContent = `${hours}h ${minutes}m ${seconds}s`;
      }, 1000);
    });
  }

  updateForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const newEmail = document.getElementById('new-email').value;
    const newUsername = document.getElementById('new-username').value;

    const { data: { user }, error } = await supabase.auth.getUser();

    if (error || !user) {
      alert('Fel: kunde inte hämta användare');
      return;
    }

    if (newEmail) {
      await supabase.auth.updateUser({ email: newEmail });
    }

    if (newUsername) {
      await supabase.from('Profiles').update({ username: newUsername }).eq('id', user.id);
    }

    alert('Dina uppgifter har uppdaterats!');
  });

  function forgotPassword() {
    const email = prompt("Ange din email för återställning:");
    if (!email) return;

    supabase.auth.resetPasswordForEmail(email, {
      redirectTo: window.location.href
    }).then(({ error }) => {
      if (error) {
        alert('Fel: ' + error.message);
      } else {
        alert('Mail skickat till ' + email);
      }
    });
  }
</script>
